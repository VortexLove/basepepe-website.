<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pepe Blackjack (PBJ) - DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Pixel Art Font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
    <style>
      html, body, * { font-family: 'Press Start 2P', cursive !important; }
      .card {
        width: 100px;
        height: 140px;
        background: white;
        color: black;
        border: 2px solid #222;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: bold;
        transform: translateY(-30px) scale(0.9);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }
      .card.deal {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    </style>
  </head>
  <body class="bg-gray-950 text-white min-h-screen">
    <div class="max-w-4xl mx-auto p-4 space-y-8">
      <!-- Header -->
      <header class="flex justify-between items-center py-4 border-b border-gray-700">
        <h1 class="text-3xl font-bold text-green-400">Pepe Blackjack (PBJ)</h1>
        <button id="connectButton" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded">Conectar Wallet</button>
      </header>
      <div id="status" class="text-center text-lg"></div>

      <!-- Blackjack Game -->
      <section id="blackjackGame" class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üÉè Juego de Blackjack</h2>
        <!-- Balance y Apuesta -->
        <div class="mb-4 text-sm flex items-center space-x-8">
          <div>Saldo PBJ: <span id="pbjBalance" class="font-mono">100000</span></div>
          <div class="flex items-center space-x-2">
            <label for="betAmount">Apuesta:</label>
            <input type="number" id="betAmount" min="1" step="1" value="1000" class="w-24 p-1 rounded bg-gray-800 text-white text-sm" />
          </div>
        </div>
        <!-- √Årea de Cartas -->
        <div class="space-y-4 relative h-48">
          <div id="dealerArea" class="absolute top-16 left-1/2 transform -translate-x-1/2 flex space-x-2"></div>
          <div id="playerArea" class="absolute bottom-16 left-1/2 transform -translate-x-1/2 flex space-x-2"></div>
        </div>
        <!-- Puntuaci√≥n debajo de cada fila -->
        <div class="flex justify-between text-sm mb-4">
          <div>Crupier Puntos: <span id="dealerScore">0</span></div>
          <div class="text-right">Jugador Puntos: <span id="playerScore">0</span></div>
        </div>
        <!-- Controles -->
        <div class="mt-4 flex space-x-2">
          <button id="dealBtn" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded">Repartir</button>
          <button id="hitBtn" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded" disabled>Pedir</button>
          <button id="standBtn" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded" disabled>Plantarse</button>
        </div>
        <!-- Mensaje de resultado -->
        <div id="resultMsg" class="mt-4 text-lg font-semibold text-center"></div>
      </section>
    </div>

    <script>
      const suits=['‚ô†','‚ô•','‚ô¶','‚ô£'], vals=[2,3,4,5,6,7,8,9,10,'J','Q','K','A'];
      let deck=[], dealerHand=[], playerHand=[];
      let pbjBalance = 100000;
      const pbjBalSpan = document.getElementById('pbjBalance');

      function shuffle() {
        deck = [];
        suits.forEach(s => vals.forEach(v => deck.push({s,v}))); 
        deck.sort(() => Math.random() - 0.5);
      }

      function dealCard(hand, area, index) {
        const card = deck.pop();
        hand.push(card);
        const el = document.createElement('div');
        el.className = 'card';
        el.innerText = `${card.v}${card.s}`;
        area.appendChild(el);
        setTimeout(() => el.classList.add('deal'), index * 150);
      }

      function updateScores() {
        document.getElementById('playerScore').innerText = calc(playerHand);
        document.getElementById('dealerScore').innerText = calc(dealerHand);
        // Auto end if player busts
        if(calc(playerHand) > 21) {
          document.getElementById('resultMsg').innerText = 'Has perdido';
          document.getElementById('hitBtn').disabled = true;
          document.getElementById('standBtn').disabled = true;
        }
      }

      function calc(hand) {
        let sum = 0, aces = 0;
        hand.forEach(c => {
          if(c.v === 'A') { aces++; sum += 11; }
          else if(['J','Q','K'].includes(c.v)) sum += 10;
          else sum += c.v;
        });
        while(sum > 21 && aces) { sum -= 10; aces--; }
        return sum;
      }

      document.getElementById('dealBtn').onclick = () => {
        shuffle(); dealerHand = []; playerHand = [];
        const dArea = document.getElementById('dealerArea'), pArea = document.getElementById('playerArea');
        dArea.innerHTML = ''; pArea.innerHTML = '';

        // Apuesta
        const bet = parseInt(document.getElementById('betAmount').value) || 0;
        if(bet > pbjBalance) { alert('Saldo insuficiente'); return; }
        pbjBalance -= bet;
        pbjBalSpan.innerText = pbjBalance;

        // Reparto inicial
        dealCard(dealerHand, dArea, 0);
        dealCard(playerHand, pArea, 1);
        dealCard(playerHand, pArea, 2);
        setTimeout(updateScores, 500);

        document.getElementById('hitBtn').disabled = false;
        document.getElementById('standBtn').disabled = false;
        document.getElementById('resultMsg').innerText = '';
      };

      document.getElementById('hitBtn').onclick = () => {
        dealCard(playerHand, document.getElementById('playerArea'), playerHand.length);
        setTimeout(updateScores, 500);
      };

      document.getElementById('standBtn').onclick = () => {
        const interval = setInterval(() => {
          if(calc(dealerHand) < 17) {
            dealCard(dealerHand, document.getElementById('dealerArea'), dealerHand.length);
            setTimeout(updateScores, 500);
          } else {
            clearInterval(interval);
            // Resultado
            const p = calc(playerHand), d = calc(dealerHand);
            const bet = parseInt(document.getElementById('betAmount').value) || 0;
            let msg = 'Empate';
            if(p <= 21 && (d > 21 || p > d)) { pbjBalance += bet * 2; msg = '¬°Ganaste!'; }
            else if(p > 21 || (d <= 21 && d > p)) msg = 'Has perdido';
            document.getElementById('resultMsg').innerText = msg;
            pbjBalSpan.innerText = pbjBalance;
          }
        }, 600);
      };
    </script>
  </body>
</html>
