<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BasePepe Blackjack</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* ... (estilos anteriores intactos) ... */

    select {
      font-family: 'Press Start 2P', cursive;
      background-color: #1f2833;
      border: 2px solid #66fcf1;
      color: #66fcf1;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
    }
  </style>
</head>

<body>

  <h1>üé≤ BasePepe Blackjack üé≤</h1>

  <button class="btn" id="connectWallet">üé¥ Conectar Wallet</button>
  <div id="walletAddress"></div>
  <p>Saldo: <span id="bpepeBalance">0</span> $BPEPE</p>

  <div id="gameArea">
    <select id="betAmountSelector">
      <option value="100">Apostar 100 $BPEPE</option>
      <option value="500">Apostar 500 $BPEPE</option>
      <option value="1000">Apostar 1000 $BPEPE</option>
      <option value="ALLIN">üî• All In (Todo tu saldo)</option>
    </select>
    <br>
    <button class="btn" id="startGame" disabled>üÉè Iniciar Partida</button>
    <div id="gameStatus"></div>
  </div>

  <div id="leaderboard">
    <h2>üèÜ Ranking Ganadores</h2>
    <ol id="leaderboardList"></ol>
  </div>

  <div id="popupWin">üéâ ¬°Ganaste BasePepe! üéâ</div>
  <div id="confetti"></div>

  <!-- Sonidos -->
  <audio id="soundWin" src="win-sound.mp3"></audio>
  <audio id="soundLose" src="lose-sound.mp3"></audio>

<script>
  const tokenAddress = 'TU_CONTRATO_BPEPE'; // Cambiar aqu√≠
  const tokenAbi = [
    "function balanceOf(address) view returns (uint256)",
    "function transfer(address to, uint amount) returns (bool)"
  ];

  let provider, signer, contract, userAddress;
  let realBalance = 0n;
  let localBalance = 0n;
  let leaderboard = [];

  async function connectWallet() {
    if (!window.ethereum) {
      alert('Instala MetaMask para continuar.');
      return;
    }
    provider = new ethers.BrowserProvider(window.ethereum);
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    userAddress = accounts[0];
    signer = await provider.getSigner();
    contract = new ethers.Contract(tokenAddress, tokenAbi, signer);
    document.getElementById('walletAddress').innerText = `üßæ ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
    await getBalance();
    document.getElementById('startGame').disabled = false;
  }

  async function getBalance() {
    const balance = await contract.balanceOf(userAddress);
    realBalance = balance;
    localBalance = balance;
    updateBalanceDisplay();
  }

  function updateBalanceDisplay() {
    document.getElementById('bpepeBalance').innerText = ethers.formatUnits(localBalance, 18);
  }

  function startGame() {
    const selected = document.getElementById('betAmountSelector').value;
    let betAmount;

    if (selected === 'ALLIN') {
      betAmount = localBalance;
    } else {
      betAmount = ethers.parseUnits(selected, 18);
    }

    if (localBalance < betAmount || betAmount <= 0n) {
      alert('No tienes suficiente saldo para esa apuesta.');
      return;
    }

    localBalance -= betAmount;
    updateBalanceDisplay();
    document.getElementById('gameStatus').innerText = 'üÉè Jugando partida...';

    setTimeout(() => {
      const win = Math.random() < 0.5;
      if (win) {
        const winnings = betAmount * 2n;
        localBalance += winnings;
        document.getElementById('gameStatus').innerText = `üéâ ¬°Ganaste! Premio: ${ethers.formatUnits(winnings, 18)} $BPEPE`;
        playSound('win');
        updateLeaderboard(winnings);
        showPopupWin();
      } else {
        document.getElementById('gameStatus').innerText = 'üíÄ Perdiste... ¬°Sigue intentando!';
        playSound('lose');
      }
      updateBalanceDisplay();
    }, 2000);
  }

  function playSound(result) {
    if (result === 'win') document.getElementById('soundWin').play();
    else document.getElementById('soundLose').play();
  }

  function updateLeaderboard(winnings) {
    leaderboard.push({ address: userAddress, winnings: winnings });
    leaderboard.sort((a, b) => b.winnings - a.winnings);
    if (leaderboard.length > 5) leaderboard = leaderboard.slice(0, 5);

    const list = leaderboard.map(entry => 
      `<li>${entry.address.slice(0,6)}...${entry.address.slice(-4)} gan√≥ ${ethers.formatUnits(entry.winnings, 18)} $BPEPE</li>`
    ).join('');

    document.getElementById('leaderboardList').innerHTML = list;
  }

  function showPopupWin() {
    const popup = document.getElementById('popupWin');
    const confettiContainer = document.getElementById('confetti');

    popup.classList.add('show');

    for (let i = 0; i < 100; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.animationDuration = (2 + Math.random() * 3) + 's';
      confettiContainer.appendChild(confetti);
    }

    setTimeout(() => {
      popup.classList.remove('show');
      confettiContainer.innerHTML = '';
    }, 4000);
  }

  document.getElementById('connectWallet').addEventListener('click', connectWallet);
  document.getElementById('startGame').addEventListener('click', startGame);
</script>

</body>
</html>
