<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pepe Blackjack (PBJ) - DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
    <style>
      body { font-family: 'Press Start 2P', cursive; }
    </style>
  </head>
  <body class="bg-gray-950 text-white min-h-screen font-sans">
    <div class="max-w-4xl mx-auto p-4 space-y-8">
      <!-- Header -->
      <header class="flex justify-between items-center py-4 border-b border-gray-700">
        <h1 class="text-3xl font-bold text-green-400">Pepe Blackjack (PBJ)</h1>
        <button id="connectButton" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded text-white font-semibold">Conectar Wallet</button>
      </header>

      <div id="status" class="text-center text-lg"></div>

      <!-- Componente de Compra -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-semibold mb-4">Compra de Tokens</h2>
        <div class="mb-4 flex justify-between">
          <span>Saldo de ETH:</span>
          <span id="ethBalance" class="font-mono">- ETH</span>
        </div>
        <!-- Input ETH -->
        <div class="flex items-center justify-between mb-4">
          <label for="ethAmount" class="text-sm">Cantidad en ETH:</label>
          <input type="number" id="ethAmount" min="0.01" step="0.01" value="0.01" class="w-32 p-2 rounded bg-gray-800 text-white border border-gray-600" />
        </div>
        <div class="mb-4">
          <span class="text-sm">Equivale a:</span>
          <span id="pbjEstimate" class="font-mono">0 PBJ</span>
        </div>
        <div class="text-right">
          <button id="buyButton" disabled class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded text-white font-semibold">Comprar</button>
        </div>
      </section>

      <!-- Lore -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üìñ Lore</h2>
        <p class="text-gray-300 leading-relaxed">
          Pepe Blackjack (PBJ) surge de la legendaria mesa de las ranas del ciber-casino. Este token mezcla el humor meme con la emoci√≥n del blackjack,
          ofreciendo una experiencia √∫nica de riesgo y recompensa en la Blockchain de Base.
        </p>
      </section>

      <!-- Roadmap -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üó∫Ô∏è Roadmap</h2>
        <ul class="list-disc list-inside text-gray-300 space-y-2">
          <li><strong>Q2 2025:</strong> Preventa PBJ en Base y lanzamiento oficial.</li>
          <li><strong>Q3 2025:</strong> Listado en DEX, funcionalidades de staking.</li>
          <li><strong>Q4 2025:</strong> Plataforma de Blackjack Web3 con integraci√≥n NFT.</li>
          <li><strong>Q1 2026:</strong> Expansi√≥n metaverso y recompensas para holders.</li>
        </ul>
      </section>

      <!-- Tokenomics -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üìä Tokenomics</h2>
        <ul class="text-gray-300 space-y-1">
          <li><strong>S√≠mbolo:</strong> PBJ</li>
          <li><strong>Red:</strong> Base</li>
          <li><strong>Supply total:</strong> 1,000,000,000 PBJ</li>
          <li><strong>Precio (Preventa):</strong> 1 ETH = 1,000,000 PBJ</li>
          <li><strong>Contrato:</strong> <a href="https://basescan.org/address/0x3Bcc79d679d900b78684F44FF7DacC286fAb0C57" class="text-blue-400 underline" target="_blank">0x3Bcc...0C57</a></li>
        </ul>
      </section>

      <!-- Equipo y Enlaces -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üë• Equipo y Enlaces</h2>
        <ul class="text-gray-300 space-y-2">
          <li><strong>Equipo:</strong> Jane Doe (Desarrollo), John Smith (Marketing), CryptoFrogDAO (Comunidad)</li>
          <li><strong>Sitio oficial:</strong> <a href="#" class="text-blue-400 underline">www.pepeblackjack.io</a></li>
          <li><strong>Twitter:</strong> <a href="https://twitter.com/pepeblackjack" class="text-blue-400 underline">@pepeblackjack</a></li>
          <li><strong>Telegram:</strong> <a href="https://t.me/pepeblackjack" class="text-blue-400 underline">@pepeblackjack</a></li>
        </ul>
      </section>

      <!-- FAQ -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">‚ùì FAQ</h2>
        <div class="text-gray-300 space-y-4">
          <div>
            <h3 class="font-semibold">¬øC√≥mo compro PBJ?</h3>
            <p>Conecta tu wallet, ajusta la cantidad en ETH y haz clic en "Comprar".</p>
          </div>
          <div>
            <h3 class="font-semibold">¬øCu√°l es el m√≠nimo de compra?</h3>
            <p>El m√≠nimo es 0.01 ETH (10,000 PBJ).</p>
          </div>
          <div>
            <h3 class="font-semibold">¬øQu√© sucede cuando finaliza la preventa?</h3>
            <p>La funci√≥n <code>endPresale()</code> desactiva las compras; solo podr√°s intercambiar en DEX posteriormente.</p>
          </div>
        </div>
      </section>
    </div>

    <script>
      const contractAddress = '0x3Bcc79d679d900b78684F44FF7DacC286fAb0C57';
      const abi = ['function buyTokens() payable'];
      const rate = 1000000; // PBJ por ETH
      let provider, signer, contract;

      const connectButton = document.getElementById('connectButton');
      const buyButton = document.getElementById('buyButton');
      const statusDiv = document.getElementById('status');
      const ethAmountInput = document.getElementById('ethAmount');
      const pbjEstimateSpan = document.getElementById('pbjEstimate');
      const ethBalanceSpan = document.getElementById('ethBalance');

      connectButton.onclick = async () => {
        if (window.ethereum) {
          try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send('eth_requestAccounts', []);
            signer = provider.getSigner();
            contract = new ethers.Contract(contractAddress, abi, signer);
            const addr = await signer.getAddress();
            const bal = await provider.getBalance(addr);
            ethBalanceSpan.innerText = `${parseFloat(ethers.utils.formatEther(bal)).toFixed(4)} ETH`;
            statusDiv.innerText = '‚úÖ Wallet conectada';
            buyButton.disabled = false;
          } catch (err) {
            statusDiv.innerText = 'Error: ' + err.message;
          }
        } else {
          statusDiv.innerText = 'MetaMask no detectado';
        }
      };

      ethAmountInput.oninput = () => {
        const ethVal = parseFloat(ethAmountInput.value) || 0;
        pbjEstimateSpan.innerText = `${(ethVal * rate).toLocaleString('fullwide', { useGrouping:false })} PBJ`;
      };

      buyButton.onclick = async () => {
        if (!contract) {
          statusDiv.innerText = 'Primero conecta la wallet';
          return;
        }
        try {
          const ethVal = parseFloat(ethAmountInput.value) || 0;
          const value = ethers.utils.parseEther(ethVal.toString());
          statusDiv.innerText = '‚åõ Confirmar en MetaMask';
          const tx = await contract.buyTokens({ value });
          statusDiv.innerText = `üì® Tx enviada: ${tx.hash.slice(0,10)}...`;
          await tx.wait();
          statusDiv.innerText = '‚úÖ Compra exitosa';
        } catch (e) {
          statusDiv.innerText = '‚ùå ' + (e.data?.message || e.message);
        }
      };

      // Inicializar
      ethAmountInput.dispatchEvent(new Event('input'));
    </script>
  </body>
</html>
