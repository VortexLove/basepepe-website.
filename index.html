<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pepe Blackjack (PBJ) - DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- tsParticles para fondo animado -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
    <!-- Pixel Art Font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
    <style>
      html, body, * {
        font-family: 'Press Start 2P', cursive !important;
      }
      #tsparticles {
        position: fixed;
        z-index: -1;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
      }
      .card {
        position: relative;
        width: 120px;
        height: 160px;
        background: white;
        border: 2px solid #222;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: bold;
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }
      .card.deal {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      .card .corner {
        position: absolute;
        font-size: 0.8rem;
      }
      .card .top-left {
        top: 4px;
        left: 6px;
      }
      .card .bottom-right {
        bottom: 4px;
        right: 6px;
        transform: rotate(180deg);
      }
      .red-suit {
        color: red;
      }
      .black-suit {
        color: black;
      }
    </style>
  </head>
  <body class="bg-gray-950 text-white min-h-screen">
    <div id="tsparticles"></div>
    <div class="max-w-4xl mx-auto p-4 space-y-8">
      <header class="flex justify-between items-center py-4 border-b border-gray-700">
        <h1 class="text-3xl font-bold text-green-400">Pepe Blackjack (PBJ)</h1>
        <button id="connectButton" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded text-white">Conectar Wallet</button>
      </header>
      <div id="status" class="text-center text-lg"></div>

      <!-- Componente de Compra -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-semibold mb-4">Compra de Tokens</h2>
        <div class="mb-4 flex justify-between">
          <span>Saldo de ETH:</span>
          <span id="ethBalance" class="font-mono">- ETH</span>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
          <div class="flex items-center justify-between">
            <label for="ethAmount">ETH:</label>
            <input type="number" id="ethAmount" min="0.01" step="0.01" value="0.01" class="w-32 p-2 rounded bg-gray-800 text-white border border-gray-600" />
          </div>
          <div class="flex items-center justify-between">
            <label for="pbjAmount">PBJ:</label>
            <input type="number" id="pbjAmount" min="10000" step="10000" value="10000" class="w-32 p-2 rounded bg-gray-800 text-white border border-gray-600" />
          </div>
        </div>
        <div class="text-right">
          <button id="buyButton" disabled class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded text-white">Comprar</button>
        </div>
      </section>

      <!-- Aqu√≠ podr√≠as insertar el componente del juego si lo deseas -->
       <section id="blackjackGame" class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üÉè Juego de Blackjack</h2>
        <div class="mb-4 text-sm flex items-center space-x-8">
          <div>Saldo PBJ: <span id="pbjBalance" class="font-mono">100000</span></div>
          <div class="flex items-center space-x-2">
            <label for="betAmount">Apuesta:</label>
            <input type="number" id="betAmount" min="1" step="1" value="1000" class="w-24 p-1 rounded bg-gray-800 text-white text-sm" />
          </div>
        </div>
        <div class="relative" style="height: 420px;">
          <div id="dealerArea" class="absolute top-0 left-1/2 transform -translate-x-1/2 flex space-x-3"></div>
          <div class="absolute top-44 left-1/2 transform -translate-x-1/2 text-sm text-center">Crupier Puntos: <span id="dealerScore">0</span></div>

          <div id="playerArea" class="absolute bottom-0 left-1/2 transform -translate-x-1/2 flex space-x-2"></div>
          <div class="absolute bottom-40 left-1/2 transform -translate-x-1/2 text-sm text-center">Jugador Puntos: <span id="playerScore">0</span></div>
        </div>

        <div class="mt-4 flex space-x-2">
          <button id="dealBtn" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded">Repartir</button>
          <button id="hitBtn" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded" disabled>Pedir</button>
          <button id="standBtn" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded" disabled>Plantarse</button>
        </div>

        <div id="resultMsg" class="mt-4 text-lg font-semibold text-center"></div>
      </section>

      <!-- Lore -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üìñ Lore</h2>
        <p class="text-gray-300 leading-relaxed">
          Pepe Blackjack (PBJ) surge de la legendaria mesa de las ranas del ciber-casino. Este token mezcla el humor meme con la emoci√≥n del blackjack,
          ofreciendo una experiencia √∫nica de riesgo y recompensa en la Blockchain de Base.
        </p>
      </section>

      <!-- Roadmap -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üó∫Ô∏è Roadmap</h2>
        <ul class="list-disc list-inside text-gray-300 space-y-2">
          <li><strong>Q2 2025:</strong> Preventa PBJ en Base y lanzamiento oficial.</li>
          <li><strong>Q3 2025:</strong> Listado en DEX, funcionalidades de staking.</li>
          <li><strong>Q4 2025:</strong> Plataforma de Blackjack Web3 con integraci√≥n NFT.</li>
          <li><strong>Q1 2026:</strong> Expansi√≥n metaverso y recompensas para holders.</li>
        </ul>
      </section>

      <!-- Tokenomics -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üìä Tokenomics</h2>
        <ul class="text-gray-300 space-y-1">
          <li><strong>S√≠mbolo:</strong> PBJ</li>
          <li><strong>Red:</strong> Base</li>
          <li><strong>Supply total:</strong> 1,000,000,000 PBJ</li>
          <li><strong>Precio (Preventa):</strong> 1 ETH = 1,000,000 PBJ</li>
          <li><strong>Contrato:</strong> <a href="https://basescan.org/address/0x3Bcc79d679d900b78684F44FF7DacC286fAb0C57" class="text-blue-400 underline" target="_blank">0x3Bcc...0C57</a></li>
        </ul>
      </section>

      <!-- Equipo y Enlaces -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üë• Equipo y Enlaces</h2>
        <ul class="text-gray-300 space-y-2">
          <li><strong>Equipo:</strong> Jane Doe (Desarrollo), John Smith (Marketing), CryptoFrogDAO (Comunidad)</li>
          <li><strong>Sitio oficial:</strong> <a href="#" class="text-blue-400 underline">www.pepeblackjack.online</a></li>
          <li><strong>Twitter:</strong> <a href="https://twitter.com/pepeblackjack" class="text-blue-400 underline">@pepeblackjack</a></li>
          <li><strong>Telegram:</strong> <a href="https://t.me/pepeblackjack" class="text-blue-400 underline">@pepeblackjack</a></li>
        </ul>
      </section>

      <!-- FAQ -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-green-400 mb-4">‚ùì FAQ</h2>
        <div class="text-gray-300 space-y-4">
          <div>
            <h3 class="font-semibold">¬øC√≥mo compro PBJ?</h3>
            <p>Conecta tu wallet, ingresa la cantidad en ETH o PBJ y presiona "Comprar".</p>
          </div>
          <div>
            <h3 class="font-semibold">¬øCu√°l es el m√≠nimo de compra?</h3>
            <p>El m√≠nimo es 0.01 ETH (10,000 PBJ).</p>
          </div>
          <div>
            <h3 class="font-semibold">¬øQu√© sucede cuando finaliza la preventa?</h3>
            <p>La funci√≥n <code>endPresale()</code> desactiva las compras; solo podr√°s intercambiar en DEX posteriormente.</p>
          </div>
        </div>
      </section>


      </div>
    </div>

    <script>
      tsParticles.load("tsparticles", {
        background: { color: { value: "#000" } },
        fpsLimit: 60,
        interactivity: {
          events: { onHover: { enable: true, mode: "repulse" }, resize: true },
          modes: { repulse: { distance: 100, duration: 0.4 } }
        },
        particles: {
          color: { value: "#00ff99" },
          links: { enable: true, color: "#00ff99", distance: 150 },
          move: { enable: true, speed: 2 },
          number: { value: 60 },
          opacity: { value: 0.5 },
          shape: { type: "circle" },
          size: { value: { min: 1, max: 3 } }
        },
        detectRetina: true
      });
    </script>
    <script>
      const suits=['‚ô†','‚ô•','‚ô¶','‚ô£'], vals=[2,3,4,5,6,7,8,9,10,'J','Q','K','A'];
      let deck=[], dealerHand=[], playerHand=[];
      let pbjBalance = 100000;
      const pbjBalSpan = document.getElementById('pbjBalance');

      function shuffle() {
        deck = [];
        suits.forEach(s => vals.forEach(v => deck.push({s,v})));
        deck.sort(() => Math.random() - 0.5);
      }

      function dealCard(hand, area, index) {
        const card = deck.pop();
        hand.push(card);
        const isRed = card.s === '‚ô•' || card.s === '‚ô¶';
        const el = document.createElement('div');
        el.className = card ${isRed ? 'red-suit' : 'black-suit'};
        el.innerHTML = 
          <div class="corner top-left">${card.v}${card.s}</div>
          <div class="corner bottom-right">${card.v}${card.s}</div>
          ${card.v}${card.s}
        ;
        area.appendChild(el);
        setTimeout(() => el.classList.add('deal'), index * 150);
      }

      function updateScores() {
        const p = calc(playerHand);
        const d = calc(dealerHand);
        document.getElementById('playerScore').innerText = p;
        document.getElementById('dealerScore').innerText = d;

        if(p > 21) {
          document.getElementById('resultMsg').innerText = 'Has perdido';
          document.getElementById('hitBtn').disabled = true;
          document.getElementById('standBtn').disabled = true;
        }
      }

      function calc(hand) {
        let sum = 0, aces = 0;
        hand.forEach(c => {
          if(c.v === 'A') { aces++; sum += 11; }
          else if(['J','Q','K'].includes(c.v)) sum += 10;
          else sum += c.v;
        });
        while(sum > 21 && aces) { sum -= 10; aces--; }
        return sum;
      }

      document.getElementById('dealBtn').onclick = () => {
        shuffle(); dealerHand = []; playerHand = [];
        const dArea = document.getElementById('dealerArea'), pArea = document.getElementById('playerArea');
        dArea.innerHTML = ''; pArea.innerHTML = '';

        const bet = parseInt(document.getElementById('betAmount').value) || 0;
        if(bet > pbjBalance) { alert('Saldo insuficiente'); return; }
        pbjBalance -= bet;
        pbjBalSpan.innerText = pbjBalance;

        dealCard(dealerHand, dArea, 0);
        dealCard(playerHand, pArea, 1);
        dealCard(playerHand, pArea, 2);
        setTimeout(updateScores, 500);

        document.getElementById('hitBtn').disabled = false;
        document.getElementById('standBtn').disabled = false;
        document.getElementById('resultMsg').innerText = '';
      };

      document.getElementById('hitBtn').onclick = () => {
        dealCard(playerHand, document.getElementById('playerArea'), playerHand.length);
        setTimeout(() => {
          updateScores();
          if (calc(playerHand) > 21) {
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
          }
        }, 500);
      };

      document.getElementById('standBtn').onclick = () => {
        const interval = setInterval(() => {
          if(calc(dealerHand) < 17) {
            dealCard(dealerHand, document.getElementById('dealerArea'), dealerHand.length);
            setTimeout(updateScores, 500);
          } else {
            clearInterval(interval);
            const p = calc(playerHand), d = calc(dealerHand);
            const bet = parseInt(document.getElementById('betAmount').value) || 0;
            let msg = 'Empate';
            if(p <= 21 && (d > 21 || p > d)) { pbjBalance += bet * 2; msg = '¬°Ganaste!'; }
            else if(p > 21 || (d <= 21 && d > p)) msg = 'Has perdido';
            document.getElementById('resultMsg').innerText = msg;
            pbjBalSpan.innerText = pbjBalance;
          }
        }, 600);
      };
    </script>
    <script>
      const contractAddress = '0x3Bcc79d679d900b78684F44FF7DacC286fAb0C57';
      const abi = ['function buyTokens() payable'];
      const rate = 1000000;
      let provider, signer, contract;
      const connectButton = document.getElementById('connectButton');
      const buyButton = document.getElementById('buyButton');
      const statusDiv = document.getElementById('status');
      const ethAmountInput = document.getElementById('ethAmount');
      const pbjAmountInput = document.getElementById('pbjAmount');
      const ethBalanceSpan = document.getElementById('ethBalance');

      function updateEstimate() {
        const ethVal = parseFloat(ethAmountInput.value) || 0;
        const pbjVal = parseFloat(pbjAmountInput.value) || 0;
        if (document.activeElement === ethAmountInput) {
          pbjAmountInput.value = (ethVal * rate).toFixed(0);
        } else {
          ethAmountInput.value = (pbjVal / rate).toFixed(6);
        }
      }
      ethAmountInput.addEventListener('input', updateEstimate);
      pbjAmountInput.addEventListener('input', updateEstimate);

      connectButton.addEventListener('click', async () => {
        if (!window.ethereum) {
          statusDiv.innerText = 'MetaMask no detectado';
          return;
        }
        try {
          provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send('eth_requestAccounts', []);
          signer = provider.getSigner();
          contract = new ethers.Contract(contractAddress, abi, signer);
          const addr = await signer.getAddress();
          const bal = await provider.getBalance(addr);
          ethBalanceSpan.innerText = ${parseFloat(ethers.utils.formatEther(bal)).toFixed(4)} ETH;
          statusDiv.innerText = '‚úÖ Wallet conectada';
          buyButton.disabled = false;
        } catch (err) {
          statusDiv.innerText = 'Error: ' + err.message;
        }
      });

      buyButton.addEventListener('click', async () => {
        if (!contract) {
          statusDiv.innerText = 'Primero conecta la wallet';
          return;
        }
        try {
          const ethVal = parseFloat(ethAmountInput.value) || 0;
          const value = ethers.utils.parseEther(ethVal.toString());
          statusDiv.innerText = '‚åõ Confirmar en MetaMask';
          const tx = await contract.buyTokens({ value });
          statusDiv.innerText = üì® Tx enviada: ${tx.hash.slice(0,10)}...;
          await tx.wait();
          statusDiv.innerText = '‚úÖ Compra exitosa';
        } catch (e) {
          statusDiv.innerText = '‚ùå ' + (e.data?.message || e.message);
        }
      });

      ethAmountInput.dispatchEvent(new Event('input'));
    </script>
    <script>
  let provider;
  let signer;
  let userAddress;
  let pbjContract;

  const PBJ_CONTRACT_ADDRESS = "0xE31Ee1462aCF2eE7b930D340B3e49DC921034A4F";
  const PBJ_ABI = [
    "function balanceOf(address account) view returns (uint256)"
  ];

  async function connectWallet() {
    if (typeof window.ethereum === "undefined") {
      alert("MetaMask no est√° disponible");
      return;
    }

    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();
    document.getElementById("status").textContent = Conectado: ${userAddress};

    pbjContract = new ethers.Contract(PBJ_CONTRACT_ADDRESS, PBJ_ABI, provider);
    updatePBJBalance();
  }

  async function updatePBJBalance() {
    if (!pbjContract || !userAddress) return;
    try {
      const rawBalance = await pbjContract.balanceOf(userAddress);
      const formatted = ethers.utils.formatUnits(rawBalance, 18); // asume 18 decimales
      document.getElementById("pbjBalance").textContent = Number(formatted).toLocaleString();
    } catch (err) {
      console.error("Error al obtener balance:", err);
      document.getElementById("pbjBalance").textContent = "Error";
    }
  }

  document.getElementById("connectButton").addEventListener("click", connectWallet);
</script>
  </body>
</html>
