<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BasePepe Blackjack</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background-color: #101010;
      color: #00ff99;
      text-align: center;
      padding: 20px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 18px;
      cursor: pointer;
      background-color: #00ff99;
      border: none;
      color: black;
      border-radius: 5px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 150px;
    }
    .card {
      font-size: 30px;
      margin: 10px;
    }
  </style>
</head>
<body>

  <h1>üé≤ BasePepe Blackjack</h1>

  <div>
    <button onclick="connectWallet()">Conectar MetaMask</button>
    <p id="walletAddress">Wallet: No conectada</p>
  </div>

  <hr>

  <h2>üî• Preventa de BasePepe</h2>
  <p>1 ETH = 1,000,000 BasePepe</p>
  <input type="number" id="ethAmount" placeholder="ETH a invertir" min="0.01" max="2" step="0.01">
  <button onclick="buyTokens()">Comprar Tokens</button>
  <p id="preSaleStatus"></p>

  <hr>

  <h2>üÉè Blackjack</h2>
  <p>Tokens disponibles: <span id="tokenBalance">0</span> BasePepe</p>
  <input type="number" id="betAmount" placeholder="Apostar BasePepe">
  <button onclick="startGame()">Repartir Cartas</button>
  <div id="gameArea" style="margin-top:20px;">
    <div>
      <h3>Jugador</h3>
      <div id="playerHand"></div>
    </div>
    <div>
      <h3>Crupier</h3>
      <div id="dealerHand"></div>
    </div>
    <button onclick="hit()">Pedir Carta</button>
    <button onclick="stand()">Plantarse</button>
    <p id="gameResult"></p>
  </div>

  <script>
    const CONTRACT_ADDRESS = "0xTuContrato"; // Reemplaza con tu direcci√≥n
    const TOKEN_ABI = [ 
      // Reemplaza con el ABI de tu contrato que tenga `buyTokens()` y `balanceOf(address)`
    ];

    let provider, signer, contract, userAddress;

    async function connectWallet() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        document.getElementById("walletAddress").innerText = `Wallet: ${userAddress}`;
        contract = new ethers.Contract(CONTRACT_ADDRESS, TOKEN_ABI, signer);
        updateBalance();
      } else {
        alert("MetaMask no est√° disponible");
      }
    }

    async function buyTokens() {
      const ethAmount = document.getElementById("ethAmount").value;
      if (ethAmount < 0.01 || ethAmount > 2) {
        alert("Debes invertir entre 0.01 y 2 ETH");
        return;
      }
      try {
        const tx = await contract.buyTokens({ value: ethers.utils.parseEther(ethAmount) });
        await tx.wait();
        document.getElementById("preSaleStatus").innerText = "Compra exitosa üöÄ";
        updateBalance();
      } catch (err) {
        document.getElementById("preSaleStatus").innerText = "Error en la compra ‚ùå";
        console.error(err);
      }
    }

    async function updateBalance() {
      if (!contract || !userAddress) return;
      const balance = await contract.balanceOf(userAddress);
      const formatted = ethers.utils.formatUnits(balance, 18);
      document.getElementById("tokenBalance").innerText = parseFloat(formatted).toFixed(2);
    }

    // Blackjack L√≥gica (versi√≥n simple sin cartas gr√°ficas)
    let deck = [], playerHand = [], dealerHand = [], bet = 0;

    function startGame() {
      bet = parseInt(document.getElementById("betAmount").value);
      if (isNaN(bet) || bet <= 0) {
        alert("Ingresa una apuesta v√°lida.");
        return;
      }
      deck = createDeck();
      shuffle(deck);
      playerHand = [drawCard(), drawCard()];
      dealerHand = [drawCard()];
      renderHands();
      document.getElementById("gameResult").innerText = "";
    }

    function createDeck() {
      const suits = ["‚ô†", "‚ô•", "‚ô£", "‚ô¶"];
      const values = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
      let d = [];
      for (let s of suits) {
        for (let v of values) {
          d.push({ value: v, suit: s });
        }
      }
      return d;
    }

    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    function drawCard() {
      return deck.pop();
    }

    function getPoints(hand) {
      let total = 0;
      let aces = 0;
      for (let c of hand) {
        if (["J", "Q", "K"].includes(c.value)) total += 10;
        else if (c.value === "A") {
          total += 11;
          aces++;
        } else {
          total += parseInt(c.value);
        }
      }
      while (total > 21 && aces > 0) {
        total -= 10;
        aces--;
      }
      return total;
    }

    function renderHands() {
      document.getElementById("playerHand").innerHTML = playerHand.map(c => `<span class="card">${c.value}${c.suit}</span>`).join("");
      document.getElementById("dealerHand").innerHTML = dealerHand.map(c => `<span class="card">${c.value}${c.suit}</span>`).join("");
    }

    function hit() {
      playerHand.push(drawCard());
      renderHands();
      if (getPoints(playerHand) > 21) {
        endGame("Perdiste ü™¶");
      }
    }

    function stand() {
      while (getPoints(dealerHand) < 17) {
        dealerHand.push(drawCard());
      }
      renderHands();
      const playerPts = getPoints(playerHand);
      const dealerPts = getPoints(dealerHand);
      if (dealerPts > 21 || playerPts > dealerPts) {
        endGame("Ganaste üéâ");
      } else if (dealerPts === playerPts) {
        endGame("Empate ü§ù");
      } else {
        endGame("Perdiste ü™¶");
      }
    }

    function endGame(result) {
      document.getElementById("gameResult").innerText = result;
    }
  </script>
</body>
</html>
