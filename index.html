<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pepe Blackjack (PBJ) - Compra de Tokens</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Press Start 2P', cursive; }
    </style>
  </head>
  <body class="bg-gradient-to-br from-purple-900 via-pink-900 to-purple-800 text-white min-h-screen">
    <div class="max-w-4xl mx-auto p-4 space-y-8">
      <!-- Header -->
      <header class="flex justify-between items-center py-4 border-b border-pink-500">
        <h1 class="text-3xl font-bold text-pink-400">Pepe Blackjack (PBJ)</h1>
        <button id="connectButton" class="bg-pink-500 hover:bg-pink-600 px-4 py-2 rounded text-white">Conectar Wallet</button>
      </header>

      <div id="status" class="text-center text-xs"></div>

      <!-- Componente de Compra -->
      <section class="bg-purple-900 bg-opacity-70 p-6 rounded-xl shadow-2xl">
        <h2 class="text-2xl mb-4 text-pink-400">üöÄ Compra de Tokens</h2>
        <div class="mb-4 flex justify-between text-xs">
          <span>Saldo de ETH:</span>
          <span id="ethBalance">- ETH</span>
        </div>
        <!-- Selector ETH / PBJ -->
        <div class="flex gap-2 mb-4 text-xs">
          <button id="modeEth" class="flex-1 py-2 rounded bg-pink-600 hover:bg-pink-700">Pagar con ETH</button>
          <button id="modePbj" class="flex-1 py-2 rounded bg-pink-600 hover:bg-pink-700">Pagar con PBJ</button>
        </div>
        <!-- Inputs -->
        <div class="space-y-4 text-xs">
          <div class="flex items-center justify-between">
            <label for="ethAmount">ETH:</label>
            <input type="number" id="ethAmount" min="0.01" step="0.01" value="0.01" class="w-24 p-2 rounded bg-purple-800 text-white text-xs" />
          </div>
          <div class="flex items-center justify-between">
            <label for="pbjAmount">PBJ:</label>
            <input type="number" id="pbjAmount" min="10000" step="10000" class="w-24 p-2 rounded bg-purple-800 text-white text-xs" />
          </div>
        </div>
        <div class="text-right">
          <button id="buyButton" disabled class="mt-4 bg-pink-500 hover:bg-pink-600 px-6 py-2 rounded text-xs">Comprar</button>
        </div>
      </section>

      <!-- Lore -->
      <section class="bg-purple-900 bg-opacity-70 p-6 rounded-xl shadow-2xl text-xs">
        <h2 class="text-xl mb-2 text-pink-400">üìñ Lore</h2>
        <p>
          Pepe Blackjack (PBJ) nace en las mesas digitales del ciber-casino de las ranas legendarias. Fusiona el esp√≠ritu meme con la adrenalina del blackjack,
          brindando una experiencia Web3 √∫nica de riesgo y recompensa.
        </p>
      </section>

      <!-- Roadmap -->
      <section class="bg-purple-900 bg-opacity-70 p-6 rounded-xl shadow-2xl text-xs">
        <h2 class="text-xl mb-2 text-pink-400">üó∫Ô∏è Roadmap</h2>
        <ul class="list-decimal list-inside space-y-2">
          <li><strong>Fase 1 (Q2 2025):</strong> Preventa en Base y lanzamiento del token PBJ.</li>
          <li><strong>Fase 2 (Q3 2025):</strong> Listado en DEX y staking de PBJ con recompensas exclusivas.</li>
          <li><strong>Fase 3 (Q4 2025):</strong> Lanzamiento del Blackjack Web3: mesas p√∫blicas y privadas.</li>
          <li><strong>Fase 4 (Q1 2026):</strong> Integraci√≥n de Slots, Ruleta y Dados: la segunda tanda de juegos.</li>
          <li><strong>Fase 5 (Q2 2026):</strong> Lanzamiento de Poker y Loter√≠a Blockchain con jackpots progresivos.</li>
          <li><strong>Fase 6 (Q3 2026):</strong> Modo Casino Social: torneos, chat y sistema de niveles para jugadores.</li>
          <li><strong>Fase 7 (Q4 2026):</strong> Integraci√≥n NFT: compra y personalizaci√≥n de avatares y mesas.</li>
          <li><strong>Fase 8 (Q1 2027):</strong> Expansi√≥n Metaverso: casino en entorno 3D VR con mundos tem√°ticos.</li>
          <li><strong>Fase 9 (Q2 2027):</strong> Alianzas y eventos globales: torneos con criptomonedas y tokens de socios.</li>
        </ul>
      </section>

      <!-- Tokenomics -->
      <section class="bg-purple-900 bg-opacity-70 p-6 rounded-xl shadow-2xl text-xs">
        <h2 class="text-xl mb-2 text-pink-400">üìä Tokenomics</h2>
        <ul class="space-y-1">
          <li><strong>S√≠mbolo:</strong> PBJ</li>
          <li><strong>Red:</strong> Base</li>
          <li><strong>Supply total:</strong> 1,000,000,000 PBJ</li>
          <li><strong>Precio:</strong> 1 ETH = 1,000,000 PBJ</li>
          <li><strong>Contrato:</strong> <a href="https://basescan.org/address/0x3Bcc79d679d900b78684F44FF7DacC286fAb0C57" class="text-pink-300 underline" target="_blank">0x3Bcc...0C57</a></li>
        </ul>
      </section>

      <!-- Equipo y Enlaces -->
      <section class="bg-purple-900 bg-opacity-70 p-6 rounded-xl shadow-2xl text-xs">
        <h2 class="text-xl mb-2 text-pink-400">üë• Equipo y Enlaces</h2>
        <ul class="space-y-1">
          <li><strong>Equipo Clave:</strong> Jane Doe (Dev), John Smith (Marketing), CryptoFrogDAO (Comunidad)</li>
          <li><strong>Sitio oficial:</strong> <a href="#" class="text-pink-300 underline">www.pepeblackjack.io</a></li>
          <li><strong>Twitter:</strong> <a href="https://twitter.com/pepeblackjack" class="text-pink-300 underline">@pepeblackjack</a></li>
          <li><strong>Telegram:</strong> <a href="https://t.me/pepeblackjack" class="text-pink-300 underline">@pepeblackjack</a></li>
        </ul>
      </section>

      <!-- FAQ -->
      <section class="bg-purple-900 bg-opacity-70 p-6 rounded-xl shadow-2xl text-xs">
        <h2 class="text-xl mb-2 text-pink-400">‚ùì FAQ</h2>
        <div class="space-y-3">
          <div>
            <h3 class="font-bold">¬øC√≥mo compro PBJ?</h3>
            <p>Conecta tu wallet, elige ETH o PBJ, ajusta la cantidad y haz clic en "Comprar".</p>
          </div>
          <div>
            <h3 class="font-bold">¬øMonto m√≠nimo?</h3>
            <p>0.01 ETH (10,000 PBJ).</p>
          </div>
          <div>
            <h3 class="font-bold">¬øQu√© pasa al finalizar la preventa?</h3>
            <p>Se llama <code>endPresale()</code>, habilitando solo intercambios en DEX.</p>
          </div>
        </div>
      </section>
    </div>

    <script>
      const contractAddress = '0x3Bcc79d679d900b78684F44FF7DacC286fAb0C57';
      const abi = ['function buyTokens() payable'];
      const rate = 1000000;
      let provider, signer, contract;
      const connectButton = document.getElementById('connectButton');
      const buyButton = document.getElementById('buyButton');
      const statusDiv = document.getElementById('status');
      const ethAmountInput = document.getElementById('ethAmount');
      const pbjAmountInput = document.getElementById('pbjAmount');
      const modeEth = document.getElementById('modeEth');
      const modePbj = document.getElementById('modePbj');
      const ethBalanceSpan = document.getElementById('ethBalance');
      let buyMode = 'ETH';
      function updateEstimate() {
        const ethVal = parseFloat(ethAmountInput.value) || 0;
        const pbjVal = parseFloat(pbjAmountInput.value) || 0;
        if (buyMode === 'ETH') pbjAmountInput.value = (ethVal * rate).toFixed(0);
        else ethAmountInput.value = (pbjVal / rate).toFixed(6);
      }
      modeEth.onclick = () => { buyMode = 'ETH'; modeEth.classList.add('bg-pink-700'); modePbj.classList.remove('bg-pink-700'); ethAmountInput.removeAttribute('disabled'); pbjAmountInput.setAttribute('disabled', true); updateEstimate(); };
      modePbj.onclick = () => { buyMode = 'PBJ'; modePbj.classList.add('bg-pink-700'); modeEth.classList.remove('bg-pink-700'); pbjAmountInput.removeAttribute('disabled'); ethAmountInput.setAttribute('disabled', true); updateEstimate(); };
      ethAmountInput.addEventListener('input', updateEstimate);
      pbjAmountInput.addEventListener('input', updateEstimate);
      connectButton.onclick = async () => {
        if (window.ethereum) {
          provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send('eth_requestAccounts', []);
          signer = provider.getSigner();
          contract = new ethers.Contract(contractAddress, abi, signer);
          const addr = await signer.getAddress();
          const bal = await provider.getBalance(addr);
          ethBalanceSpan.innerText = `${parseFloat(ethers.utils.formatEther(bal)).toFixed(4)} ETH`;
          statusDiv.innerText = '‚úÖ Wallet conectada';
          buyButton.disabled = false;
        } else statusDiv.innerText = 'MetaMask no detectado';
      };
      buyButton.onclick = async () => {
        try {
          const ethVal = buyMode === 'ETH' ? parseFloat(ethAmountInput.value) : parseFloat(ethAmountInput.value);
          const value = ethers.utils.parseEther(ethVal.toString());
          statusDiv.innerText = '‚åõ Confirma en MetaMask';
          const tx = await contract.buyTokens({ value });
          statusDiv.innerText = `üì® Tx: ${tx.hash.slice(0,10)}...`;
          await tx.wait(); statusDiv.innerText = '‚úÖ Compra exitosa';
        } catch (e) { statusDiv.innerText = '‚ùå ' + (e.data?.message || e.message); }
      };
      modeEth.click();

    let saldo = 1000; // Saldo inicial del jugador
    let apuesta = 100; // Apuesta inicial
    let deck = [], dealerHand = [], playerHand = [];

    const suits = ['‚ô†Ô∏è','‚ô•Ô∏è','‚ô¶Ô∏è','‚ô£Ô∏è'];
    const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

    // Funci√≥n para crear y barajar el mazo
    function createDeck() {
      deck = [];
      suits.forEach(suit => {
        values.forEach(value => {
          deck.push({ suit, value });
        });
      });
      shuffleDeck();
    }

    function shuffleDeck() {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    // Funci√≥n para repartir cartas
    function dealCard(hand) {
      const card = deck.pop();
      hand.push(card);
      return card;
    }

    // Mostrar cartas en la mano
    function displayHand(hand, isDealer = false) {
      const handDiv = isDealer ? document.getElementById('dealer-cards') : document.getElementById('player-cards');
      handDiv.innerHTML = '';
      hand.forEach(card => {
        const cardDiv = document.createElement('div');
        cardDiv.classList.add('card');
        cardDiv.textContent = `${card.value} ${card.suit}`;
        handDiv.appendChild(cardDiv);
      });
    }

    // Calcular puntaje de la mano
    function calculateScore(hand) {
      let score = 0;
      let aceCount = 0;
      hand.forEach(card => {
        if (card.value === 'A') {
          aceCount++;
          score += 11;
        } else if (['K','Q','J'].includes(card.value)) {
          score += 10;
        } else {
          score += parseInt(card.value);
        }
      });
      while (score > 21 && aceCount > 0) {
        score -= 10;
        aceCount--;
      }
      return score;
    }

    // Actualizar el puntaje en la interfaz
    function updateScores() {
      const playerScore = calculateScore(playerHand);
      const dealerScore = calculateScore(dealerHand);
      document.getElementById('player-score').textContent = playerScore;
      document.getElementById('dealer-score').textContent = dealerScore;
    }

    // Funci√≥n para empezar el juego
    function startGame() {
      if (apuesta > saldo) {
        alert("No tienes suficientes monedas para esa apuesta.");
        return;
      }

      saldo -= apuesta;
      updateSaldo();

      dealerHand = [];
      playerHand = [];
      createDeck();
      dealCard(dealerHand);
      dealCard(playerHand);
      dealCard(playerHand);
      displayHand(dealerHand, true);
      displayHand(playerHand);
      updateScores(); // Mostrar puntaje inicial

      document.getElementById('hit-btn').disabled = false;
      document.getElementById('stand-btn').disabled = false;
      document.getElementById('bet-btn').disabled = true;
    }

    // Funci√≥n para pedir carta
    function hit() {
      dealCard(playerHand);
      displayHand(playerHand);
      updateScores(); // Actualizar puntaje despu√©s de pedir carta
      const playerScore = calculateScore(playerHand);
      if (playerScore > 21) {
        document.getElementById('message').textContent = '¬°Te has pasado! Has perdido.';
        endGame();
      }
    }

    // Funci√≥n para plantarse
    function stand() {
      let dealerScore = calculateScore(dealerHand);
      while (dealerScore < 17) {
        dealCard(dealerHand);
        dealerScore = calculateScore(dealerHand);
      }
      displayHand(dealerHand, true);
      updateScores(); // Actualizar puntaje despu√©s de plantarse

      const playerScore = calculateScore(playerHand);
      if (dealerScore > 21 || playerScore > dealerScore) {
        document.getElementById('message').textContent = '¬°Ganaste!';
        saldo += apuesta * 2;
      } else if (playerScore < dealerScore) {
        document.getElementById('message').textContent = 'Perdiste.';
      } else {
        document.getElementById('message').textContent = '¬°Empate!';
        saldo += apuesta;
      }

      updateSaldo();
      endGame();
    }

    // Funci√≥n para finalizar el juego
    function endGame() {
      document.getElementById('hit-btn').disabled = true;
      document.getElementById('stand-btn').disabled = true;
      document.getElementById('bet-btn').disabled = false;
    }

    // Actualizar saldo
    function updateSaldo() {
      document.getElementById('saldo').textContent = `Saldo: ${saldo} BasePepe`;
    }

    // Eventos
    document.getElementById('bet-btn').addEventListener('click', startGame);
    document.getElementById('hit-btn').addEventListener('click', hit);
    document.getElementById('stand-btn').addEventListener('click', stand);
    document.getElementById('bet-amount').addEventListener('input', function () {
      apuesta = parseInt(document.getElementById('bet-amount').value);
    });
  </script>
  </body>
</html>
