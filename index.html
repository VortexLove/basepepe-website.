<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BasePepe Blackjack</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #0b0c10;
      color: #66fcf1;
      font-family: 'Press Start 2P', cursive;
      text-align: center;
      padding: 40px;
    }

    h1 {
      font-size: 24px;
      color: #45a29e;
      margin-bottom: 20px;
    }

    .btn {
      font-family: 'Press Start 2P', cursive;
      background-color: #1f2833;
      border: 2px solid #66fcf1;
      color: #66fcf1;
      padding: 15px 25px;
      margin: 10px;
      cursor: pointer;
      font-size: 12px;
      border-radius: 10px;
      transition: background 0.3s;
    }

    .btn:hover {
      background-color: #45a29e;
      color: #0b0c10;
    }

    #gameArea {
      background: url('basepepe-dealer.png') center/cover no-repeat;
      padding: 50px 20px;
      border-radius: 12px;
      margin-top: 30px;
      background-blend-mode: overlay;
      background-color: rgba(0, 0, 0, 0.6);
    }

    #walletAddress {
      font-size: 12px;
      margin-top: 10px;
      color: #c5c6c7;
    }

    #bpepeBalance {
      font-size: 16px;
      font-weight: bold;
      color: #66fcf1;
    }

    #gameStatus {
      margin-top: 20px;
      font-size: 14px;
      color: #ffffff;
    }
  </style>
</head>

<body>
  <h1>üé≤ BasePepe Blackjack üé≤</h1>

  <button class="btn" id="connectWallet">üé¥ Conectar Wallet</button>
  <div id="walletAddress"></div>
  <p>Saldo: <span id="bpepeBalance">0</span> $BPEPE</p>

  <div id="gameArea">
    <button class="btn" id="startGame" disabled>üÉè Apostar 100 $BPEPE</button>
    <div id="gameStatus"></div>
  </div>

<script>
  const tokenAddress = 'TU_CONTRATO_BPEPE'; // << Pega aqu√≠ la direcci√≥n de tu contrato
  const tokenAbi = [
    "function balanceOf(address) view returns (uint256)",
    "function transfer(address to, uint amount) returns (bool)"
  ];

  let provider;
  let signer;
  let contract;
  let userAddress;
  let realBalance = 0;
  let localBalance = 0;
  const betAmount = ethers.parseUnits('100', 18); // 100 BPEPE (ajustado a 18 decimales)

  async function connectWallet() {
    if (!window.ethereum) {
      alert('Instala MetaMask para continuar.');
      return;
    }
    provider = new ethers.BrowserProvider(window.ethereum);
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    userAddress = accounts[0];
    signer = await provider.getSigner();
    contract = new ethers.Contract(tokenAddress, tokenAbi, signer);
    
    document.getElementById('walletAddress').innerText = `üßø ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
    await getBalance();
    document.getElementById('startGame').disabled = false;
  }

  async function getBalance() {
    const balance = await contract.balanceOf(userAddress);
    realBalance = balance;
    localBalance = balance; // Copia local
    updateBalanceDisplay();
  }

  function updateBalanceDisplay() {
    document.getElementById('bpepeBalance').innerText = ethers.formatUnits(localBalance, 18);
  }

  function startGame() {
    if (localBalance < betAmount) {
      alert('No tienes suficiente saldo para apostar.');
      return;
    }

    localBalance -= betAmount;
    updateBalanceDisplay();

    document.getElementById('gameStatus').innerText = 'üÉè Jugando partida...';

    // Simulaci√≥n resultado partida
    setTimeout(() => {
      const win = Math.random() < 0.5; // 50% probabilidad ganar
      if (win) {
        const winnings = betAmount * 2n;
        localBalance += winnings;
        document.getElementById('gameStatus').innerText = 'üéâ ¬°Ganaste! Premio: 200 $BPEPE';
      } else {
        document.getElementById('gameStatus').innerText = 'üíÄ Perdiste... ¬°Sigue intentando!';
      }
      updateBalanceDisplay();
    }, 2000);
  }

  document.getElementById('connectWallet').addEventListener('click', connectWallet);
  document.getElementById('startGame').addEventListener('click', startGame);
</script>

</body>
</html>
